spring.application.name=tinyurl

snowflake.generator.baseUrl=http://127.0.0.1:8081

# MySQL config for local development
spring.datasource.url=jdbc:mysql://localhost:3306/tinyurl_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true
spring.datasource.username=root
spring.datasource.password=
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

logging.file.name=app.log
logging.logback.rollingpolicy.max-file-size=100MB
logging.logback.rollingpolicy.max-history=30
logging.logback.rollingpolicy.total-size-cap=1GB
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n


# Enable SQL initialization
# Run even if tables exist (use 'embedded' for H2/HSQL only, 'always' for all DBs)
spring.sql.init.mode=always
# Continue on error (optional - useful if tables already exist)
spring.sql.init.continue-on-error=true
# Platform-specific scripts (optional)
spring.sql.init.platform=mysql
# Script locations (optional - defaults to schema.sql and data.sql)
spring.sql.init.schema-locations=classpath:schema.sql


# ===========================================
# HikariCP Connection Pool Settings
# ===========================================

# Pool sizing
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5

# Connection timeout (how long to wait for a connection from pool)
spring.datasource.hikari.connection-timeout=30000

# Idle timeout (how long a connection can sit idle before being removed)
spring.datasource.hikari.idle-timeout=600000

# Max lifetime (max time a connection can exist, should be less than MySQL wait_timeout)
spring.datasource.hikari.max-lifetime=1800000

# Keepalive time (how often to test idle connections)
spring.datasource.hikari.keepalive-time=300000

# Pool name (for monitoring/logging)
spring.datasource.hikari.pool-name=TinyUrlHikariPool

# Validation query
spring.datasource.hikari.connection-test-query=SELECT 1

# Auto-commit
spring.datasource.hikari.auto-commit=true

# Virtual threads
spring.threads.virtual.enabled=true

# ===========================================
# Redis Cache Configuration
# ===========================================

# Redis connection
spring.data.redis.host=localhost
spring.data.redis.port=6379
# spring.data.redis.password=yourpassword  # Uncomment if Redis requires auth

# Connection pool (using Lettuce - Spring Boot default)
spring.data.redis.lettuce.pool.max-active=50
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=1000ms

# Connection timeout
spring.data.redis.timeout=2000ms

# ===========================================
# TinyURL Cache Settings
# ===========================================

# TTL for cached URLs in hours (default: 24 hours)
# URLs are immutable, so long TTL is fine
# TTL is refreshed on each access (hot URLs stay cached indefinitely)
cache.url.ttl-hours=24

# ===========================================
# Click Tracking Settings
# ===========================================

# How often to flush accumulated click counts from Redis to DB (in ms)
# Default: 60000 (1 minute)
# Lower = more accurate counts but more DB writes
# Higher = fewer DB writes but counts are more delayed
click.flush.interval-ms=60000